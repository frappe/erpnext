<style>
@media screen {
	.print-format {
		padding: 10mm;
	}
}

.print-format {
	font-size: 8.0pt !important;
}
.print-format td, .print-format th {
	vertical-align:middle !important;
}
</style>

{% function print_group(data, group) { %}
<h2 class="text-center" style="margin-top:0">{%= __(report.report_name) %}</h2>

{% if (filters.customer_name || filters.supplier_name || group.party_name || filters.customer || filters.supplier || group.party) { %}
	<h4 class="text-center">
	{% if (filters.customer_name || filters.supplier_name || group.party_name) { %}
		{%= filters.customer_name || filters.supplier_name || group.party_name %}
	{% } else { %}
		{%= filters.customer || filters.supplier || group.party %}
	{% } %}
	</h4>
{% } %}

{% if (filters.sales_person || group.sales_person) { %}
	<h6 class="text-center">
		{%= __("Sales Person: ")%}{%= filters.sales_person || group.sales_person %}
	</h6>
{% } %}

<h5 class="text-center">
	{%= __(filters.ageing_based_on) %}
	{%= __("Until") %}
	{%= new frappe.datetime.datetime(filters.report_date).format("D MMMM, YYYY") %}
</h5>

<div class="clearfix">
	<div class="pull-left">
	{% if(filters.payment_terms || group.payment_terms) { %}
		<strong>{%= __("Payment Terms") %}:</strong> {%= filters.payment_terms || group.payment_terms %}
	{% } %}
	</div>
	<div class="pull-right">
	{% if(filters.credit_limit || group.credit_limit) { %}
		<strong>{%= __("Credit Limit") %}:</strong> {%= format_currency(filters.credit_limit || group.credit_limit) %}
	{% } %}
	</div>
</div>

{% if(filters.show_pdc_in_print) { %}
	{% var balance_row = data.slice(-1).pop();
		var range1 = report.columns.find(d => d.fieldname == "range1").label;
		var range2 = report.columns.find(d => d.fieldname == "range2").label;
		var range3 = report.columns.find(d => d.fieldname == "range3").label;
		var range4 = report.columns.find(d => d.fieldname == "range4").label;
	%}
	{% if(balance_row) { %}
	<table class="table table-bordered table-condensed">
		<caption class="text-right">(Amount in {%= data[0][__("currency")] || "" %})</caption>
	        <colgroup>
	            <col style="width: 30mm;">
	            <col style="width: 18mm;">
	            <col style="width: 18mm;">
	            <col style="width: 18mm;">
	            <col style="width: 18mm;">
	            <col style="width: 18mm;">
	            <col style="width: 18mm;">
	        </colgroup>

		<thead>
			<tr>
				<th>{%= __(" ") %}</th>
				<th>{%= __(range1) %}</th>
				<th>{%= __(range2) %}</th>
				<th>{%= __(range3) %}</th>
				<th>{%= __(range4) %}</th>
				<th>{%= __("Total") %}</th>
			</tr>
		</thead>
		<tbody>
			<tr>
				<td>{%= __("Total Outstanding") %}</td>
				<td class="text-right">{%= format_currency(balance_row[range1]) %}</td>
				<td class="text-right">{%= format_currency(balance_row[range2]) %}</td>
				<td class="text-right">{%= format_currency(balance_row[range3]) %}</td>
				<td class="text-right">{%= format_currency(balance_row[range4]) %}</td>
				<td class="text-right">
					{%= format_currency(flt(balance_row[("outstanding_amount")]), data[data.length-1]["currency"]) %}
					</td>
			</tr>
				<td>{%= __("PDC/LC") %}</td>
				<td></td>
				<td></td>
				<td></td>
				<td></td>
				<td class="text-right">
					{%= format_currency(flt(balance_row[("pdc/lc_amount")]), data[data.length-1]["currency"]) %}
				</td>
			<tr class="cvs-footer">
				<th class="text-left">{%= __("Cheques Required") %}</th>
				<th></th>
				<th></th>
				<th></th>
				<th></th>
				<th class="text-right">
					{%= format_currency(flt(balance_row[("outstanding_amount")]-balance_row[("pdc/lc_amount")]), data[data.length-1]["currency"]) %}</th>
			</tr>
		</tbody>

	</table>
	{% } %}
{% } %}

<table class="table table-bordered">
	<thead>
		<tr>
			{% if(report.report_name === "Accounts Receivable" || report.report_name === "Accounts Payable") { %}
				<th style="width: 10%">{%= __("Date") %}</th>
				<th style="width: 3%">{%= __("Age (Days)") %}</th>
				{% if(report.report_name === "Accounts Receivable" && filters.show_sales_person_in_print) { %}
					<th style="width: 16%">{%= __("Reference") %}</th>
					<th style="width: 11%">{%= __("Sales Person") %}</th>
				{% } else { %}
					<th style="width: 27%">{%= __("Reference") %}</th>
				{% } %}
				{% if(!filters.show_pdc_in_print) { %}
					<th style="width: 20%">{%= (filters.customer || filters.supplier || group.party) ? __("Remarks"): __("Party") %}</th>
				{% } %}
				<th style="width: 10%; text-align: right">{%= __("Invoiced Amount") %}</th>
				{% if(!filters.show_pdc_in_print) { %}
					<th style="width: 10%; text-align: right">{%= __("Paid Amount") %}</th>
					<th style="width: 10%; text-align: right">{%= report.report_name === "Accounts Receivable" ? __('Credit Note') : __('Debit Note') %}</th>
				{% } %}
				<th style="width: 10%; text-align: right">{%= __("Outstanding Amount") %}</th>
				{% if(filters.show_pdc_in_print) { %}
					{% if(report.report_name === "Accounts Receivable") { %}
						<th style="width: 10%">{%= __("Customer LPO No.") %}</th>
					{% } %}
					<th style="width: 10%">{%= __("PDC/LC Ref") %}</th>
					<th style="width: 10%">{%= __("PDC/LC Amount") %}</th>
					<th style="width: 10%">{%= __("Remaining Balance") %}</th>
				{% } %}
			{% } else { %}
				{%
					var range1 = report.columns.find(d => d.fieldname == "range1").label;
					var range2 = report.columns.find(d => d.fieldname == "range2").label;
					var range3 = report.columns.find(d => d.fieldname == "range3").label;
					var range4 = report.columns.find(d => d.fieldname == "range4").label;
				%}
				<th style="width: 40%">{%= (filters.customer || filters.supplier) ? __("Remarks"): __("Party") %}</th>
				<th style="width: 15%">{%= __(range1) %}</th>
				<th style="width: 15%">{%= __(range2) %}</th>
				<th style="width: 15%">{%= __(range3) %}</th>
				<th style="width: 15%">{%= __(range4) %}</th>
			{% } %}
		</tr>
	</thead>
	<tbody>
		{% for(var i=0, l=data.length; i<l; i++) { %}
			<tr>
			{% if(report.report_name === "Accounts Receivable" || report.report_name === "Accounts Payable") { %}
				{% if(data[i]["party"]) { %}
					<td>{%= frappe.datetime.str_to_user(data[i]["posting_date"]) %}</td>
					<td style="text-align: right">
						{%= data[i]["age"] %}
						{% if(filters.mark_overdue_in_print && data[i]["due_date"] && data[i]["due_date"] < filters.report_date) { %}
							<div>{%= __("Overdue") %}</div>
						{% } %}
					</td>
					<td>
						{% if(!filters.show_pdc_in_print) { %}
							{%= data[i]["voucher_type"] %}
							<br>
						{% } %}
						{%= data[i]["voucher_no"] %}
					</td>

					{% if(report.report_name === "Accounts Receivable" && filters.show_sales_person_in_print) { %}
					<td>{%= data[i]["sales_person"] %}</td>
					{% } %}

					{% if(!filters.show_pdc_in_print) { %}
					<td>
						{% if(!data[i]["posting_date"]) { %}
							<strong>{%= data[i]["party"].substr(1, data[i]["party"].length-2) %}</strong>
						{% } else { %}
							{% if(!(filters.customer || filters.supplier || group.party)) { %}
								{%= data[i]["party"] %}
								{% if(data[i]["party_name"] && data[i]["party_name"] != data[i]["party"]) { %}
									<br>{%= data[i]["party_name"] %}
								{% } %}
							{% } %}
						{% } %}
						{% if data[i]["remarks"] %}
						<div>
							{% if (!filters.customer && !filters.supplier && !group.party) { %}{%= __("Remarks") %}:{% } %}
							{%= data[i]["remarks"] %}
						</div>
						{% } %}
					</td>
					{% } %}

					<td style="text-align: right">{% if (data[i]["invoiced_amount"] != null) { %}
						{%= format_currency(data[i]["invoiced_amount"], data[i]["currency"]) %}
                    {% } %}</td>

					{% if(!filters.show_pdc_in_print) { %}
						<td style="text-align: right">{% if (data[i]["paid_amount"] != null) { %}
							{%= format_currency(data[i]["paid_amount"], data[i]["currency"]) %}
                        {% } %}</td>
						<td style="text-align: right">{% if (data[i]["return_amount"] != null) { %}
							{%= format_currency(data[i]["return_amount"], data[i]["currency"])  %}
                        {% } %}</td>
					{% } %}
					<td style="text-align: right">{% if (data[i]["outstanding_amount"] != null) { %}
						{%= format_currency(data[i]["outstanding_amount"], data[i]["currency"]) %}
                    {% } %}</td>

					{% if(filters.show_pdc_in_print) { %}
						{% if(report.report_name === "Accounts Receivable") { %}
							<td style="text-align: right">
								{%= data[i]["po_no"] %}</td>
						{% } %}
						<td style="text-align: right">{%= data[i][("pdc/lc_ref")] %}</td>
						<td style="text-align: right">{% if (data[i]["pdc/lc_amount"] != null) { %}
                            {%= format_currency(data[i][("pdc/lc_amount")], data[i]["currency"]) %}
                        {% } %}</td>
						<td style="text-align: right">{% if (data[i]["remaining_balance"] != null) { %}
                            {%= format_currency(data[i][("remaining_balance")], data[i]["currency"]) %}
                        {% } %}</td>
					{% } %}
				{% } else { %}
					{% if($.isEmptyObject(data[i])) { %}
						{% var colspan = 5 %}
						{% if(report.report_name === "Accounts Receivable" && filters.show_sales_person_in_print) { colspan++; } %}
						{% if(!filters.show_pdc_in_print) { colspan += 3; } %}
						{% if(filters.show_pdc_in_print) { %}
							{% colspan += 3; %}
							{% if(report.report_name === "Accounts Receivable") { colspan++; } %}
						{% } %}
						<td colspan="{%= colspan %}"></td>
					{% } else { %}
						{% var colspan = 3 %}
						{% if(report.report_name === "Accounts Receivable" && filters.show_sales_person_in_print) { colspan++; } %}
						{% if(!filters.show_pdc_in_print) { colspan++; } %}
						<td colspan="{%= colspan %}" style="text-align: right"><b>{%= data[i]['voucher_type'] || __("Total") %}</b></td>
						<td style="text-align: right">
							{%= format_currency(data[i]["invoiced_amount"], data[i]["currency"] ) %}</td>

						{% if(!filters.show_pdc_in_print) { %}
							<td style="text-align: right">
								{%= format_currency(data[i]["paid_amount"], data[i]["currency"]) %}</td>
							<td style="text-align: right">{%= format_currency(data[i]["return_amount"], data[i]["currency"])  %} </td>
						{% } %}
						<td style="text-align: right">
							{%= format_currency(data[i]["outstanding_amount"], data[i]["currency"]) %}</td>

						{% if(filters.show_pdc_in_print) { %}
							{% if(report.report_name === "Accounts Receivable") { %}
								<td style="text-align: right">
									{%= data[i]["po_no"] %}</td>
							{% } %}
							<td style="text-align: right">{%= data[i][("pdc/lc_ref")] %}</td>
							<td style="text-align: right">{%= format_currency(data[i][("pdc/lc_amount")], data[i]["currency"]) %}</td>
							<td style="text-align: right">{%= format_currency(data[i][("remaining_balance")], data[i]["currency"]) %}</td>
						{% } %}
					{% } %}
				{% } %}
			{% } else { %}
				{% if(data[i]["party"] != __("Total")) { %}
					<td>
						{% if(!(filters.customer || filters.supplier)) { %}
							{%= data[i]["party"] %}
							{% if(data[i]["party_name"] && data[i]["party_name"] != data[i]["party"]) { %}
								<br>{%= data[i]["party_name"] %}
							{% } %}
						{% } %}
					</td>
				{% } else { %}
					<td><b>{%= __("Total") %}</b></td>
				{% } %}
				<td style="text-align: right">{%= format_currency(data[i]["range1"], data[i]["currency"]) %}</td>
				<td style="text-align: right">{%= format_currency(data[i]["range2"], data[i]["currency"]) %}</td>
				<td style="text-align: right">{%= format_currency(data[i]["range3"], data[i]["currency"]) %}</td>
				<td style="text-align: right">{%= format_currency(data[i]["range4"], data[i]["currency"]) %}</td>
			{% } %}
			</tr>
		{% } %}
	</tbody>
</table>
<p class="text-right text-muted">{{ __("Printed On ") }}{%= frappe.datetime.str_to_user(frappe.datetime.get_datetime_as_string()) %}</p>
{% } %}

{{ frappe.utils.print_report_groups(data, print_group, print_settings.page_break_groups, _p) }}
